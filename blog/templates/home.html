{% extends "base.html" %}

{% block title %}Home - Clanker{% endblock %}

{% block content %}
    {% if session.user_id %}
        <div class="post-form">
            <form method="POST" action="/post">
                <textarea 
                    class="post-input" 
                    placeholder="What's happening?"
                    name="content"
                    required
                    maxlength="280"
                ></textarea>
                <div class="post-actions">
                    <span class="char-count">280 characters remaining</span>
                    <button type="submit" class="btn">Post</button>
                </div>
            </form>
        </div>
    {% endif %}

    <div id="posts">
        {% for post in posts %}
            <div class="post" data-post-id="{{ post.id }}">
                <div class="post-header">
                    {% if post.profile_image %}
                        <img src="{{ post.profile_image }}" alt="Profile picture" class="post-avatar">
                    {% else %}
                        <div class="post-avatar default-avatar">üë§</div>
                    {% endif %}
                    <div class="post-user-info" onclick="window.app.goToProfile('{{ post.username }}')">
                        <span class="post-display-name">{{ post.display_name }}</span>
                        <span class="post-username">@{{ post.username }}</span>
                        <span class="post-time" data-timestamp="{{ post.created_at }}">{{ post.created_at }}</span>
                    </div>
                </div>
                <div class="post-content" onclick="window.app.goToPost({{ post.id }})" style="cursor: pointer; transition: background-color 0.2s;" onmouseover="this.style.backgroundColor='#f7f9fa'" onmouseout="this.style.backgroundColor='transparent'">{{ post.content }}</div>
                <div class="post-actions-bar">
                    <button class="action-btn reply-btn" onclick="window.app.toggleReplyForm({{ post.id }})">
                        üí¨ {{ post.reply_count }}
                    </button>
                    <button class="action-btn like-btn" 
                            onclick="window.app.toggleLike({{ post.id }}, this)" 
                            data-post-id="{{ post.id }}"
                            data-liked="{% if post.user_liked %}true{% else %}false{% endif %}">
                        {% if post.user_liked %}‚ù§Ô∏è{% else %}ü§ç{% endif %} {{ post.like_count }}
                    </button>
                    {% if post.is_clanker %}
                        <button class="action-btn clanked-btn" 
                                onclick="window.app.toggleClanked({{ post.id }}, this)" 
                                data-post-id="{{ post.id }}"
                                data-clanked="{% if post.user_clanked %}true{% else %}false{% endif %}">
                            {% if post.user_clanked %}ü§ñ{% else %}ü§ñ{% endif %} {{ post.clanked_count }}
                        </button>
                    {% endif %}
                </div>
                
                <div id="replyForm{{ post.id }}" class="reply-form" style="display: none;">
                    <form onsubmit="submitReply(event, {{ post.id }})">
                        <input 
                            type="text" 
                            class="reply-input" 
                            placeholder="Write a reply..."
                            name="content"
                            required
                        >
                        <button type="submit" class="btn">Reply</button>
                    </form>
                </div>
            </div>
        {% else %}
            <div class="empty-state">
                <div class="empty-state-icon">üê¶</div>
                <h3>No posts yet</h3>
                <p>Be the first to share something!</p>
            </div>
        {% endfor %}
    </div>

    <script>
        // Refresh notifications in background on home page too
        document.addEventListener('DOMContentLoaded', function() {
            // Refresh notifications every second in background
            setInterval(function() {
                if (window.app && window.app.refreshNotifications) {
                    window.app.refreshNotifications();
                }
            }, 1000);
        });
    </script>
{% endblock %}
